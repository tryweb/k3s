# Fleet GitOps 配置檔案 - 環境選擇入口
#
# 切換環境方式：
#   方法 1: 修改下方 helm.chart 和 valuesFiles 設定
#   方法 2: 使用符號連結
#          ln -sf fleet-dev.yaml fleet.yaml   # 切換到開發環境
#          ln -sf fleet-prod.yaml fleet.yaml  # 切換到正式環境
#
# 可用環境配置：
#   - fleet-dev.yaml  : 使用 fork repo PR 分支 (測試修正)
#   - fleet-prod.yaml : 使用官方 Helm repo release (穩定版本)
#
# values 檔案說明：
#   - values-dev.yaml        : 開發環境用 (包含完整預設值 + 自訂值)
#   - values-custom.yaml     : 自訂值 (只包含非預設值，正式環境用)
#
# 注意：開發環境使用 git:: URL 時，不會自動合併 chart 預設值
#       必須先執行 ./scripts/generate-values-dev.sh 產生 values-dev.yaml
# ============================================================

defaultNamespace: librenms

helm:
  # ============================================================
  # 環境切換：取消註解所需的環境設定
  # ============================================================

  # --- 開發環境：使用 fork repo PR 分支 ---
  # 注意：必須使用 values-dev.yaml（包含完整預設值）
  # 產生方式: ./scripts/generate-values-dev.sh --repo tryweb/librenms-helm-charts --branch fix/snmp-scanner-securitycontext
  # chart: git::https://github.com/tryweb/librenms-helm-charts//charts/librenms?ref=fix/snmp-scanner-securitycontext

  # --- 正式環境：使用官方 Helm repo ---
  # 注意：可使用 values-custom.yaml（chart 會自動套用預設值）
  repo: https://www.librenms.org/helm-charts
  chart: librenms
  # version: "6.1.0"

  # ============================================================

  releaseName: librenms

  # 開發環境使用 values-dev.yaml，正式環境使用 values-custom.yaml
  valuesFiles:
    # - values-dev.yaml      # 開發環境（包含完整預設值）
    - values-custom.yaml # 正式環境（只包含自訂值）

  valuesFrom:
    - secretKeyRef:
        name: librenms-helm-values
        namespace: librenms
        key: values.yaml

  force: false
  waitForJobs: true

targets:
  - name: default
    clusterSelector: {}

diff:
  comparePatches:
    - apiVersion: v1
      kind: Secret
      operations:
        - op: remove
          path: /data
